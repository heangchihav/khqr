"use strict";var p=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var A=(r,t)=>{for(var e in t)p(r,e,{get:t[e],enumerable:!0})},f=(r,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of m(t))!y.call(r,n)&&n!==e&&p(r,n,{get:()=>t[n],enumerable:!(o=U(t,n))||o.enumerable});return r};var k=r=>f(p({},"__esModule",{value:!0}),r);var g={};A(g,{Checkitout:()=>a});module.exports=k(g);var u="https://api-checkitout.rinyato.com",d="https://checkitout.rinyato.com";function h(){return async(r,t={})=>fetch(r,t).then(async e=>{let o=await e.json();return e.ok?{data:o,error:null,response:e}:{error:o,data:null,response:e}}).catch(e=>(console.error("CHECKITOUT_ERROR",e),{error:{status:500,message:"Something went wrong."},data:null}))}var a=class{api;apiUrl;webUrl;token;constructor(t){this.token=t.token,this.apiUrl=t.apiUrl||u,this.webUrl=t.webUrl||d,this.api=h()}getCheckoutUrl(t){return new URL(`/portal/${t}`,this.webUrl).toString()}async create(t){let e=new URL("/v1/checkout",this.apiUrl),o=t.items.reduce((R,l)=>R+l.price*l.quantity,0),n=t.discount?.type==="AMOUNT"?t.discount.value:o*(t.discount?.value||0)/100,s=(o-n)*(t.tax||0)/100,i=o-n+s;if(t.total&&i!==t.total)return{error:{status:400,message:`Total amount does not match, assert: ${t.total}, calculated: ${i}`},data:null};let c={currency:t.currency,items:t.items,subTotal:o,discountType:t.discount?.type,discount:t.discount?.value,tax:t.tax,total:i,clientName:t.client.name,clientPhone:t.client.phone,clientAddress:t.client.address,redirectUrl:t.redirectUrl,additionalInfo:t.additionalInfo};return this.api(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(c)})}async findOne(t){let e=new URL(`v1/checkout/${t}`,this.apiUrl);return this.api(e,{headers:{Authorization:`Bearer ${this.token}`}})}async _INTERNAL_DO_NOT_USE_OR_YOU_WILL_BE_FIRED_track(t,e,o){let n=new URL(`/checkout/${t}/track`,this.apiUrl),s=new EventSource(n,{withCredentials:!0});return s.onmessage=i=>{let c=i.data;c==="PAID"?e():c==="WEBHOOK_CALLED"&&(o(),s.close())},()=>s.close()}};0&&(module.exports={Checkitout});
