var l="https://api-checkitout.rinyato.com",u="https://checkitout.rinyato.com";function d(){return async(a,t={})=>fetch(a,t).then(async e=>{let o=await e.json();return e.ok?{data:o,error:null,response:e}:{error:o,data:null,response:e}}).catch(e=>(console.error("CHECKITOUT_ERROR",e),{error:{status:500,message:"Something went wrong."},data:null}))}var c=class{api;apiUrl;webUrl;token;constructor(t){this.token=t.token,this.apiUrl=t.apiUrl||l,this.webUrl=t.webUrl||u,this.api=d()}getCheckoutUrl(t){return new URL(`/portal/${t}`,this.webUrl).toString()}async create(t){let e=new URL("/v1/checkout",this.apiUrl),o=t.items.reduce((h,p)=>h+p.price*p.quantity,0),s=t.discount?.type==="AMOUNT"?t.discount.value:o*(t.discount?.value||0)/100,r=(o-s)*(t.tax||0)/100,n=o-s+r;if(t.total&&n!==t.total)return{error:{status:400,message:`Total amount does not match, assert: ${t.total}, calculated: ${n}`},data:null};let i={currency:t.currency,items:t.items,subTotal:o,discountType:t.discount?.type,discount:t.discount?.value,tax:t.tax,total:n,clientName:t.client.name,clientPhone:t.client.phone,clientAddress:t.client.address,redirectUrl:t.redirectUrl,additionalInfo:t.additionalInfo};return this.api(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(i)})}async findOne(t){let e=new URL(`v1/checkout/${t}`,this.apiUrl);return this.api(e,{headers:{Authorization:`Bearer ${this.token}`}})}async _INTERNAL_DO_NOT_USE_OR_YOU_WILL_BE_FIRED_track(t,e,o){let s=new URL(`/checkout/${t}/track`,this.apiUrl),r=new EventSource(s,{withCredentials:!0});return r.onmessage=n=>{let i=n.data;i==="PAID"?e():i==="WEBHOOK_CALLED"&&(o(),r.close())},()=>r.close()}};export{c as Checkitout};
